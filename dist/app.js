define(["VSS/Controls/Notifications","VSS/Controls","VSS/Controls/Menus","VSS/Service","TFS/Core/RestClient","TFS/WorkItemTracking/RestClient","VSS/Controls/TreeView","VSS/Controls/Grids"],function(e,t,n,o,r,i,a,s){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n=window.webpackJsonp;window.webpackJsonp=function(t,o,i){for(var a,s,c=0,u=[];c<t.length;c++)s=t[c],r[s]&&u.push(r[s][0]),r[s]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a]);for(n&&n(t,o,i);u.length;)u.shift()()};var o={},r={1:0};return t.e=function(e){function n(){s.onerror=s.onload=null,clearTimeout(c);var t=r[e];0!==t&&(t&&t[1](new Error("Loading chunk "+e+" failed.")),r[e]=void 0)}var o=r[e];if(0===o)return new Promise(function(e){e()});if(o)return o[2];var i=new Promise(function(t,n){o=r[e]=[t,n]});o[2]=i;var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.timeout=12e4,t.nc&&s.setAttribute("nonce",t.nc),s.src=t.p+""+e+".js";var c=setTimeout(n,12e4);return s.onerror=s.onload=n,a.appendChild(s),i},t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t.oe=function(e){throw console.error(e),e},t(t.s=9)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){var o,r;o=[n,t,n(1),n(0),n(11),n(7)],void 0!==(r=function(e,t,n,o,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.prototype.displayMessage=function(e,t){var r=n.create(o.MessageAreaControl,$("#message"),null);r.setMessage(e,t),this.messenger=r},e.prototype.closeMessage=function(){this.messenger.hideElement()},e}();t.MessageService=a;var s=function(){function e(){}return e.prototype.getWorkItems=function(e,t){var n=new Array,o=i.getCollectionClient(r.WorkItemTrackingHttpClient),a={query:e};return o.queryByWiql(a).then(function(e){if(!e.workItems)throw new Error("The query supplied does not produce any work item results.");return e.workItems.forEach(function(e){n.push(e.id)}),o.getWorkItems(n,t)})},e.prototype.getWorkItemHierarchy=function(e,t,n){var o=new Array,a=new Array,s=i.getCollectionClient(r.WorkItemTrackingHttpClient),c={query:e};return s.queryByWiql(c).then(function(e){if(!e.workItemRelations)throw new Error("The query supplied does not produce any work item relations.");return e.workItemRelations.forEach(function(e){var t={data:{id:e.target.id,name:"",parent:e.source?e.source.id:n,link:e.target.url}};o.push(t),a.push(e.target.id)}),s.getWorkItems(a,t).then(function(e){return e.forEach(function(e,t){o.forEach(function(t,n){if(t.data.id===e.id)return t.data.name=e.fields["System.Title"],void(t.data.workItemType=e.fields["System.WorkItemType"])})}),o})})},e.prototype.getWorkItemTypes=function(){return i.getCollectionClient(r.WorkItemTrackingHttpClient).getWorkItemTypes(VSS.getWebContext().project.name)},e}();t.QueryService=s}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t,n(2),n(0),n(10),n(7)],void 0!==(r=function(e,t,o,r,i,a){"use strict";function s(e){try{e()}catch(e){p.displayMessage(e,r.MessageAreaType.Error)}}function c(e){return a.getCollectionClient(i.CoreHttpClient).getProject(e,!0)}function u(e,t){var o={},r=new Array,i=JSON.parse(e);r[0]=["RequirementId","Title","Description","MappedItems"],i.forEach(function(e,t){r[t+1]=[e.RequirementId,e.Title,e.Description,e.MappedItems]});var a={s:{c:1e7,r:1e7},e:{c:0,r:0}};n.e(0).then(function(){var e=[n(14)];(function(e){for(var n=0;n!==r.length;++n)for(var i=0;i!==r[n].toString().length;++i){a.s.r>n&&(a.s.r=n),a.s.c>i&&(a.s.c=i),a.e.r<n&&(a.e.r=n),a.e.c<i&&(a.e.c=i);var s={v:r[n][i],t:"s"};if(null!=s.v){var c=XLSX.utils.encode_cell({c:i,r:n});"number"==typeof s.v?s.t="n":"boolean"==typeof s.v?s.t="b":s.v instanceof Date?(s.t="n",s.z=XLSX.SSF._table[14],s.v=l(s.v)):s.t="s",o[c]=s}}a.s.c<1e7&&(o["!ref"]=XLSX.utils.encode_range(a));var u={SheetNames:[],Sheets:{}};u.SheetNames.push("Requirements"),u.Sheets.Requirements=o;var p=XLSX.write(u,t);return e(new Blob([function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=0;o!==e.length;++o)n[o]=255&e.charCodeAt(o);return t}(p)],{type:"application/octet-stream"}),VSS.getWebContext().project.name+".xlsx")}).apply(null,e)}).catch(n.oe)}Object.defineProperty(t,"__esModule",{value:!0});var l,p=new o.MessageService;t.executeBoundary=s,t.getProcessTemplate=c,t.exportToExcel=u}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t,n(3),n(2),n(0),n(1),n(12),n(6)],void 0!==(r=function(e,t,n,o,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this.list=JSON.parse(e)}return e.prototype.add=function(e){this.list.push(e)},e.prototype.remove=function(e){this.list.splice(this.list.indexOf(e),1)},e.prototype.update=function(e){this.list.forEach(function(t,n){if(t.RequirementId===e.RequirementId)return t.Description=e.Description,t.Title=e.Title,void(t.MappedItems=e.MappedItems)})},e.prototype.toString=function(){return JSON.stringify(this.list)},e.prototype.getItem=function(e){var t;return this.list.forEach(function(n,o){if(n.RequirementId===e)return void(t=n)}),t},e}();t.RequirementCollection=c;var u=function(){function e(){this.projectId=VSS.getWebContext().project.id,this.messenger=new o.MessageService;var e=this;e.nodes=new Array;var t=new a.TreeNode("Requirements");t.link="index.html";var c=new a.TreeNode("Iteration Path View");c.link="sprintView.html";var u=new a.TreeNode("Gap Analysis");u.link="gapAnalysis.html",e.nodes.push(t),e.nodes.push(c),e.nodes.push(u),e.tree=i.create(a.TreeView,$("#treeMenu"),{nodes:e.nodes});i.create(s.MenuBar,$("#navToolbar"),{items:[{id:"getTemplate",text:"Get Latest Template",icon:"icon-download-package",title:"Downloads the template for importing requirements via Excel"}],executeAction:function(e){switch(e.get_commandName()){case"getTemplate":window.open(VSS.getExtensionContext().baseUri+"/data/SampleRequirements.xlsx")}}});n.getProcessTemplate(e.projectId).then(function(t){e.processTemplate=t.capabilities.processTemplate.templateName},function(t){e.messenger.displayMessage(t.message,r.MessageAreaType.Error)})}return e.prototype.setActiveNode=function(e){var t=this;t.nodes.forEach(function(n,o){if(n.text===e)return void t.tree.setSelectedNode(n)})},e.prototype.validateTemplate=function(e){var t=this;setTimeout(function(){null!=t.processTemplate.match("CMMI")?($("#reqtMenu").hide(),$("#content").show().append("<span>The CMMI process template allows you to manage requirements natively.  Import, export and reporting functionality has been disabled at this time.</span>"),t.messenger.displayMessage("Warning: CMMI process template detected.",r.MessageAreaType.Warning)):e()},500)},e}();t.ViewModelBase=u}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r;o=[n,t,n(2),n(3),n(0)],void 0!==(r=function(e,t,n,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.messenger=new n.MessageService}return e.prototype.getCollection=function(e,t){var n=localStorage.getItem(e);return n.length<1&&this.messenger.displayMessage("Item '"+e+"' could not be located or has no value.",r.MessageAreaType.Warning),t?(t(n),null):n},e.prototype.setCollection=function(e,t){localStorage.setItem(e,t),this.messenger.displayMessage("Item '${id}' added/updated.",r.MessageAreaType.Info)},e.prototype.clear=function(){localStorage.clear(),this.messenger.displayMessage("Local storage has been cleared.",r.MessageAreaType.Info)},e.prototype.remove=function(e){localStorage.removeItem(e),this.messenger.displayMessage("Item '"+e+"' removed.",r.MessageAreaType.Info)},e}();t.LocalStorageAdapter=i;var a=function(){function e(e){this.scope=e||"ProjectCollection",this.messenger=new n.MessageService,this.dataService=VSS.getService(VSS.ServiceIds.ExtensionData)}return e.prototype.getCollection=function(e,t){var n=this;if(void 0===t)throw new Error("This method requires a callback function.");n.dataService.then(function(o){o.getDocument("RequirementsManagement",e).then(function(e){t(e.json)},function(e){n.messenger.displayMessage("It appears you do not have any requirements.  Please use the Import button to add requirements.",r.MessageAreaType.Info)})})},e.prototype.setCollection=function(e,t){var n=this,o={id:e,json:t};n.dataService.then(function(e){e.setDocument("RequirementsManagement",o).then(function(e){return e},function(e){n.messenger.displayMessage(e.message,r.MessageAreaType.Error)})})},e.prototype.clear=function(){var e=this;e.dataService.then(function(t){t.getDocuments("RequirementsManagement").then(function(n){n.forEach(function(e,n,o){t.deleteDocument("RequirementsManagement",e.id).then(function(e){})}),e.messenger.displayMessage("All documents successfully removed.",r.MessageAreaType.Info)})})},e.prototype.remove=function(e){var t=this;t.dataService.then(function(n){n.deleteDocument("RequirementsManagement",e).then(function(){},function(e){var n=JSON.parse(e.responseText);t.messenger.displayMessage(n.message,r.MessageAreaType.Error)})})},e}();t.VsoDocumentServiceAdapter=a;var s=function(){function e(e){this.scope=e,this.messenger=new n.MessageService,this.dataService=VSS.getService(VSS.ServiceIds.ExtensionData)}return e.prototype.getCollection=function(e,t){var n=this;if(void 0===t)throw new Error("This method requires a callback function.");o.executeBoundary(function(){n.dataService.then(function(n){n.getValue(e).then(function(e){t(e)})})})},e.prototype.setCollection=function(e,t){var n=this;o.executeBoundary(function(){n.dataService.then(function(n){n.setValue(e,t).then(function(e){return!0})})})},e.prototype.clear=function(){o.executeBoundary(function(){throw Error("Method not implemented.")})},e.prototype.remove=function(e){var t=this;o.executeBoundary(function(){t.setCollection(e,null)})},e}();t.VsoSettingsServiceAdapter=s}.apply(t,o))&&(e.exports=r)},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,n){var o,r;o=[n,t,n(2),n(5),n(0),n(4)],void 0!==(r=function(e,t,n,o,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.store=null==e?new o.LocalStorageAdapter:e,this.msg=new n.MessageService,this.projectId=VSS.getWebContext().project.id}return e.prototype.process=function(e,t){var n,o=this,a=e.files;n=a[0];var s=new FileReader;n.name;s.onload=function(e){var n=e.target.result;try{var a=XLSX.read(n,{type:"binary"});a.SheetNames.forEach(function(e){var n=a.Sheets[e],r=XLSX.utils.sheet_to_json(n),s=new i.RequirementCollection(JSON.stringify(r));o.store.setCollection(o.projectId+"-requirements",s.toString()),t&&t()})}catch(e){o.msg.displayMessage(e.message,r.MessageAreaType.Error)}},s.readAsBinaryString(n)},e}();t.FlatFileAdapter=a;var s=function(){function e(){}return e.prototype.process=function(e){},e}();t.RepositoryAdapter=s}.apply(t,o))&&(e.exports=r)},function(e,t,n){var o,r,i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(8),n(3),n(5),n(4),n(1),n(6),n(0)],void 0!==(r=function(e,t,o,r,a,s,c,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p;!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this)||this,o=n;return o.adapter=t,$("#reqTitle").text("Requirements"),o.setActiveNode($("#reqTitle").text()),o.menu=c.create(u.MenuBar,$("#reqtMenu"),{items:[{id:"importButton",text:"Import",icon:"icon-import-reqt",title:"Imports requirements into the system"},{id:"exportButton",text:"Export",icon:"icon-export-reqt",disabled:!0,title:"Exports the requirements into an Excel document"},{id:"clearButton",text:"Delete Requirements",icon:"icon-delete",disabled:!0,title:"Deletes all requirements and mappings"}],executeAction:function(e){switch(e.get_commandName()){case"clearButton":o.clearRequirements();break;case"importButton":o.showImportDialog();break;case"exportButton":n.adapter.store.getCollection(o.projectId+"-requirements",function(e){r.exportToExcel(e,{bookType:"xlsx",bookSST:!0,type:"binary"})})}}}),n}return i(t,e),t.prototype.start=function(){var e=this,t=this;setTimeout(function(){t.validateTemplate(function(){e.adapter.store.getCollection(t.projectId+"-requirements",function(e){t.getRequirements(e)})})},750)},t.prototype.getRequirements=function(e){function t(e){var t=e.get_commandArgument().item;switch(e.get_commandName()){case"map":r.showMappingDialog(t.RequirementId);break;case"visualize":r.showVisualizationDialog(t)}}function o(){return[{id:"map",text:"Map Work Item(s)"},{separator:!0},{id:"visualize",text:"Visualize Requirement",icon:"icon-compare"}]}var r=this,i=r.menu.getItem("importButton"),a=r.menu.getItem("exportButton"),s=r.menu.getItem("clearButton");null!=e?($("#content").html(""),new Promise(function(e){e()}).then(function(){var i=[n(1),n(13)];(function(n,i){r.grid=n.create(i.Grid,$("#content"),{height:"300px",gutter:{contextMenu:!0},contextMenu:{items:o(),executeAction:t,arguments:function(e){return{item:e.item}}},columns:[{text:"ID",index:"RequirementId",width:75},{text:"Title",index:"Title",width:200},{text:"Description",index:"Description",width:500}],openRowDetail:function(e){var t=r.grid.getRowData(e);r.showMappingDialog(t.RequirementId)},source:JSON.parse(e)})}).apply(null,i)}).catch(n.oe),$("#content").show(),r.menu.updateCommandStates([{id:"importButton",disabled:!(i.getCommandState()&u.MenuItemState.Disabled)},{id:"exportButton",disabled:!(a.getCommandState()&u.MenuItemState.Disabled)},{id:"clearButton",disabled:!(s.getCommandState()&u.MenuItemState.Disabled)}]),setTimeout(function(){$("a.mapButton").on("click",function(e){e.preventDefault(),r.showMappingDialog($(e.currentTarget).attr("req"))})},500)):(r.menu.updateCommandStates([{id:"importButton",disabled:!(i.getCommandState()&u.MenuItemState.Disabled)},{id:"exportButton",disabled:!(a.getCommandState()&u.MenuItemState.Disabled)},{id:"clearButton",disabled:!(s.getCommandState()&u.MenuItemState.Disabled)}]),r.messenger.displayMessage("It appears you do not have any requirements.  Please use the Import button to add requirements.",l.MessageAreaType.Info))},t.prototype.showVisualizationDialog=function(e){var t,n={width:800,height:600,buttons:null,title:"Visualize Requirement: "+e.RequirementId};VSS.getService(VSS.ServiceIds.Dialog).then(function(o){o.openDialog(VSS.getExtensionContext().publisherId+"."+VSS.getExtensionContext().extensionId+".visualizerDialog",n).then(function(n){n.getContributionInstance("createVisualizerDialog").then(function(n){t=n,t.start(e)},function(e){alert(e.message)})})})},t.prototype.showImportDialog=function(){var e,t=this,n=this,o={width:425,height:250,cancelText:"Close",okCallback:function(e){t.adapter.store.getCollection(n.projectId+"-requirements",function(e){n.getRequirements(e)})},title:"Import Requirements",getDialogResult:function(){return e?e.import():null}};VSS.getService(VSS.ServiceIds.Dialog).then(function(t){t.openDialog(VSS.getExtensionContext().publisherId+"."+VSS.getExtensionContext().extensionId+".importDialog",o).then(function(t){t.updateOkButton(!0),t.getContributionInstance("createImportDialog").then(function(t){e=t,e.start()},function(e){alert(e.message)})})})},t.prototype.showMappingDialog=function(e){var t,n=this,o={width:500,height:400,okText:"Save",cancelText:"Close",okCallback:function(t){var o,r=new a.VsoDocumentServiceAdapter("ProjectCollection");r.getCollection(VSS.getWebContext().project.id+"-requirements",function(i){o=new s.RequirementCollection(i);var a=o.getItem(e);a.MappedItems=t,o.update(a),r.remove(VSS.getWebContext().project.id+"-requirements"),r.setCollection(VSS.getWebContext().project.id+"-requirements",o.toString()),n.messenger.displayMessage(e+" successfully mapped to item(s) "+t+".",l.MessageAreaType.Info)})},title:"Map Work Item(s): ${reqt}",getDialogResult:function(){return t?t.save():null}};VSS.getService(VSS.ServiceIds.Dialog).then(function(e){e.openDialog(VSS.getExtensionContext().publisherId+"."+VSS.getExtensionContext().extensionId+".mappingDialog",o).then(function(e){e.getContributionInstance("createMappingDialog").then(function(e){t=e,t.start("${reqt}")},function(e){alert(e.message)}),e.updateOkButton(!0)})})},t.prototype.clearRequirements=function(){var e=this;!0===confirm("Are you sure you want to delete all requirements?  This will delete any mappings you have created as well.").valueOf()&&(e.adapter.store.remove(e.projectId+"-requirements"),$("#content").html(""),e.getRequirements())},t}(s.ViewModelBase);e.Mapper=t}(e.Core||(e.Core={}))}(p=t.rMapper||(t.rMapper={}));var d=new o.FlatFileAdapter(new a.VsoDocumentServiceAdapter("ProjectCollection"));t.rm=new p.Core.Mapper(d)}.apply(t,o))&&(e.exports=r)},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){e.exports=s}])});