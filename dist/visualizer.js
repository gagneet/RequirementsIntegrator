define(["VSS/Controls/Notifications","VSS/Controls","VSS/Service","TFS/WorkItemTracking/RestClient","TFS/Core/RestClient","VSS/Controls/Menus","VSS/Controls/TreeView","VSS/Controls/Dialogs"],function(e,t,r,n,o,a,i,s){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r=window.webpackJsonp;window.webpackJsonp=function(t,n,a){for(var i,s,c=0,u=[];c<t.length;c++)s=t[c],o[s]&&u.push(o[s][0]),o[s]=0;for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);for(r&&r(t,n,a);u.length;)u.shift()()};var n={},o={1:0,6:0,7:0,8:0,10:0,11:0};return t.e=function(e){function r(){s.onerror=s.onload=null,clearTimeout(c);var t=o[e];0!==t&&(t&&t[1](new Error("Loading chunk "+e+" failed.")),o[e]=void 0)}var n=o[e];if(0===n)return new Promise(function(e){e()});if(n)return n[2];var a=new Promise(function(t,r){n=o[e]=[t,r]});n[2]=a;var i=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.timeout=12e4,t.nc&&s.setAttribute("nonce",t.nc),s.src=t.p+""+e+".js";var c=setTimeout(r,12e4);return s.onerror=s.onload=r,i.appendChild(s),a},t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t.oe=function(e){throw console.error(e),e},t(t.s=20)}([function(t,r){t.exports=e},function(e,t,r){var n,o;n=[r,t,r(2),r(0),r(5),r(3)],void 0!==(o=function(e,t,r,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.displayMessage=function(e,t){$("#message").html("");var o=r.create(n.MessageAreaControl,$("#message"),null);o.setMessage(e,t),this.messenger=o},e.prototype.closeMessage=function(){this.messenger.hideElement()},e}();t.MessageService=i;var s=function(){function e(){}return e.prototype.getWorkItems=function(e,t){var r=new Array,n=a.getCollectionClient(o.WorkItemTrackingHttpClient),i={query:e};return n.queryByWiql(i).then(function(e){if(!e.workItems)throw new Error("The query supplied does not produce any work item results.");return e.workItems.forEach(function(e){r.push(e.id)}),n.getWorkItems(r,t)})},e.prototype.getWorkItemHierarchy=function(e,t,r){var n=new Array,i=new Array,s=a.getCollectionClient(o.WorkItemTrackingHttpClient),c={query:e};return s.queryByWiql(c).then(function(e){if(!e.workItemRelations)throw new Error("The query supplied does not produce any work item relations.");return e.workItemRelations.forEach(function(e){var t={data:{id:e.target.id,name:"",parent:e.source?e.source.id:r,link:e.target.url}};n.push(t),i.push(e.target.id)}),s.getWorkItems(i,t).then(function(e){return e.forEach(function(e,t){n.forEach(function(t,r){if(t.data.id===e.id)return t.data.name=e.fields["System.Title"],void(t.data.workItemType=e.fields["System.WorkItemType"])})}),n})})},e.prototype.getWorkItemTypes=function(){return a.getCollectionClient(o.WorkItemTrackingHttpClient).getWorkItemTypes(VSS.getWebContext().project.name)},e}();t.QueryService=s}.apply(t,n))&&(e.exports=o)},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){var n,o;n=[r,t,r(1),r(0),r(7),r(3)],void 0!==(o=function(e,t,n,o,a,i){"use strict";function s(e){try{e()}catch(e){l.displayMessage(e,o.MessageAreaType.Error)}}function c(e){return i.getCollectionClient(a.CoreHttpClient).getProject(e,!0)}function u(e,t){var n={},o=new Array,a=JSON.parse(e);o[0]=["RequirementId","Title","Description","MappedItems"],a.forEach(function(e,t){o[t+1]=[e.RequirementId,e.Title,e.Description,e.MappedItems]});var i={s:{c:1e7,r:1e7},e:{c:0,r:0}};r.e(0).then(function(){var e=[r(12)];(function(e){for(var r=0;r!==o.length;++r)for(var a=0;a!==o[r].toString().length;++a){i.s.r>r&&(i.s.r=r),i.s.c>a&&(i.s.c=a),i.e.r<r&&(i.e.r=r),i.e.c<a&&(i.e.c=a);var s={v:o[r][a],t:"s"};if(null!=s.v){var c=XLSX.utils.encode_cell({c:a,r:r});"number"==typeof s.v?s.t="n":"boolean"==typeof s.v?s.t="b":s.v instanceof Date?(s.t="n",s.z=XLSX.SSF._table[14],s.v=p(s.v)):s.t="s",n[c]=s}}i.s.c<1e7&&(n["!ref"]=XLSX.utils.encode_range(i));var u={SheetNames:[],Sheets:{}};u.SheetNames.push("Requirements"),u.Sheets.Requirements=n;var l=XLSX.write(u,t);return e(new Blob([function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n!==e.length;++n)r[n]=255&e.charCodeAt(n);return t}(l)],{type:"application/octet-stream"}),VSS.getWebContext().project.name+".xlsx")}).apply(null,e)}).catch(r.oe)}Object.defineProperty(t,"__esModule",{value:!0});var p,l=new n.MessageService;t.executeBoundary=s,t.getProcessTemplate=c,t.exportToExcel=u}.apply(t,n))&&(e.exports=o)},function(e,t){e.exports=n},function(e,t,r){var n,o;n=[r,t,r(1),r(4),r(0)],void 0!==(o=function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.messenger=new r.MessageService}return e.prototype.getCollection=function(e,t){var r=localStorage.getItem(e);return r.length<1&&this.messenger.displayMessage("Item '"+e+"' could not be located or has no value.",o.MessageAreaType.Warning),t?(t(r),null):r},e.prototype.setCollection=function(e,t){localStorage.setItem(e,t),this.messenger.displayMessage("Item '${id}' added/updated.",o.MessageAreaType.Info)},e.prototype.clear=function(){localStorage.clear(),this.messenger.displayMessage("Local storage has been cleared.",o.MessageAreaType.Info)},e.prototype.remove=function(e){localStorage.removeItem(e),this.messenger.displayMessage("Item '${id}' removed.",o.MessageAreaType.Info)},e}();t.LocalStorageAdapter=a;var i=function(){function e(e){this.scope=e||"ProjectCollection",this.messenger=new r.MessageService,this.dataService=VSS.getService(VSS.ServiceIds.ExtensionData)}return e.prototype.getCollection=function(e,t){var r=this;if(void 0===t)throw new Error("This method requires a callback function.");r.dataService.then(function(n){n.getDocument("RequirementsManagement",e).then(function(e){t(e.json)},function(e){r.messenger.displayMessage("It appears you do not have any requirements.  Please use the Import button to add requirements.",o.MessageAreaType.Info)})})},e.prototype.setCollection=function(e,t){var r=this,n={id:e,json:t};r.dataService.then(function(e){e.setDocument("RequirementsManagement",n).then(function(e){return e},function(e){r.messenger.displayMessage(e.message,o.MessageAreaType.Error)})})},e.prototype.clear=function(){var e=this;e.dataService.then(function(t){t.getDocuments("RequirementsManagement").then(function(r){r.forEach(function(e,r,n){t.deleteDocument("RequirementsManagement",e.id).then(function(e){})}),e.messenger.displayMessage("All documents successfully removed.",o.MessageAreaType.Info)})})},e.prototype.remove=function(e){var t=this;t.dataService.then(function(r){r.deleteDocument("RequirementsManagement",e).then(function(){},function(e){var r=JSON.parse(e.responseText);t.messenger.displayMessage(r.message,o.MessageAreaType.Error)})})},e}();t.VsoDocumentServiceAdapter=i;var s=function(){function e(e){this.scope=e,this.messenger=new r.MessageService,this.dataService=VSS.getService(VSS.ServiceIds.ExtensionData)}return e.prototype.getCollection=function(e,t){var r=this;if(void 0===t)throw new Error("This method requires a callback function.");n.executeBoundary(function(){r.dataService.then(function(r){r.getValue(e).then(function(e){t(e)})})})},e.prototype.setCollection=function(e,t){var r=this;n.executeBoundary(function(){r.dataService.then(function(r){r.setValue(e,t).then(function(e){return!0})})})},e.prototype.clear=function(){n.executeBoundary(function(){throw Error("Method not implemented.")})},e.prototype.remove=function(e){var t=this;n.executeBoundary(function(){t.setCollection(e,null)})},e}();t.VsoSettingsServiceAdapter=s}.apply(t,n))&&(e.exports=o)},function(e,t){e.exports=o},function(e,t,r){var n,o;n=[r,t,r(4),r(1),r(0),r(2),r(10),r(9)],void 0!==(o=function(e,t,r,n,o,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this.list=JSON.parse(e)}return e.prototype.add=function(e){this.list.push(e)},e.prototype.remove=function(e){this.list.splice(this.list.indexOf(e),1)},e.prototype.update=function(e){this.list.forEach(function(t,r){if(t.RequirementId===e.RequirementId)return t.Description=e.Description,t.Title=e.Title,void(t.MappedItems=e.MappedItems)})},e.prototype.toString=function(){return JSON.stringify(this.list)},e.prototype.getItem=function(e){var t;return this.list.forEach(function(r,n){if(r.RequirementId===e)return void(t=r)}),t},e}();t.RequirementCollection=c;var u=function(){function e(){this.projectId=VSS.getWebContext().project.id,this.messenger=new n.MessageService;var e=this;e.nodes=new Array;var t=new i.TreeNode("Requirements");t.link="index.html";var c=new i.TreeNode("Iteration Path View");c.link="sprintView.html";var u=new i.TreeNode("Gap Analysis");u.link="gapAnalysis.html",e.nodes.push(t),e.nodes.push(c),e.nodes.push(u),e.tree=a.create(i.TreeView,$("#treeMenu"),{nodes:e.nodes});a.create(s.MenuBar,$("#navToolbar"),{items:[{id:"getTemplate",text:"Get Latest Template",icon:"icon-download-package",title:"Downloads the template for importing requirements via Excel"}],executeAction:function(e){switch(e.get_commandName()){case"getTemplate":window.open(VSS.getExtensionContext().baseUri+"/data/SampleRequirements.xlsx")}}});r.getProcessTemplate(e.projectId).then(function(t){e.processTemplate=t.capabilities.processTemplate.templateName},function(t){e.messenger.displayMessage(t.message,o.MessageAreaType.Error)})}return e.prototype.setActiveNode=function(e){var t=this;t.nodes.forEach(function(r,n){if(r.text===e)return void t.tree.setSelectedNode(r)})},e.prototype.validateTemplate=function(e){var t=this;setTimeout(function(){null!=t.processTemplate.match("CMMI")?($("#reqtMenu").hide(),$("#content").show().append("<span>The CMMI process template allows you to manage requirements natively.  Import, export and reporting functionality has been disabled at this time.</span>"),t.messenger.displayMessage("Warning: CMMI process template detected.",o.MessageAreaType.Warning)):e()},500)},e}();t.ViewModelBase=u}.apply(t,n))&&(e.exports=o)},function(e,t){e.exports=a},function(e,t){e.exports=i},function(e,t,r){var n,o;n=[r,t,r(1),r(6),r(0),r(8)],void 0!==(o=function(e,t,r,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.store=null==e?new n.LocalStorageAdapter:e,this.msg=new r.MessageService,this.projectId=VSS.getWebContext().project.id}return e.prototype.process=function(e,t){var r,n=this,i=e.files;r=i[0];var s=new FileReader;r.name;s.onload=function(e){var r=e.target.result;try{var i=XLSX.read(r,{type:"binary"});i.SheetNames.forEach(function(e){var r=i.Sheets[e],o=XLSX.utils.sheet_to_json(r),s=new a.RequirementCollection(JSON.stringify(o));n.store.setCollection(n.projectId+"-requirements",s.toString()),t&&t()})}catch(e){n.msg.displayMessage(e.message,o.MessageAreaType.Error)}},s.readAsBinaryString(r)},e}();t.FlatFileAdapter=i;var s=function(){function e(){}return e.prototype.process=function(e){},e}();t.RepositoryAdapter=s}.apply(t,n))&&(e.exports=o)},,function(e,t){e.exports=s},,,,,,,function(e,t,r){var n,o,a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();n=[r,t,r(6),r(1),r(0),r(13),r(11)],void 0!==(o=function(e,t,r,n,o,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=[],u=[],p=function(e){function t(t,o){var a=e.call(this)||this,i=a;return i.cytoscape=o,i.context=t,i.messenger=new n.MessageService,i.adapter=new s.FlatFileAdapter(new r.VsoDocumentServiceAdapter("ProjectCollection")),a}return a(t,e),t.prototype.start=function(e){var t=this;if(null===e.MappedItems||""===e.MappedItems)return t.messenger.displayMessage("There are no work items mapped to this requirement.",o.MessageAreaType.Error),!1;t.mappedItems=e.MappedItems.split(","),(new n.QueryService).getWorkItemHierarchy("select [System.Id], [System.WorkItemType], [System.Title], [System.State], [System.AreaPath], [System.IterationPath], [System.Tags] from WorkItemLinks where (Source.[System.TeamProject] = '"+VSS.getWebContext().project.name+"' and (Source.[System.Id] in ("+e.MappedItems+") or Source.[System.WorkItemType] = 'Feature' or Source.[System.WorkItemType] = 'Epic')) and ([System.Links.LinkType] = 'System.LinkTypes.Hierarchy-Forward') and (Target.[System.TeamProject] = '"+VSS.getWebContext().project.name+"' and Target.[System.WorkItemType] <> '') order by [System.ChangedDate] desc mode (Recursive)",["System.WorkItemType","System.Title","System.State","System.WorkItemType"],e.RequirementId).then(function(r){var n=[],o={data:{id:e.RequirementId,name:e.Title,bkcolor:"darkgreen"}};n.push(o),r.forEach(function(e,t){switch(e.data.workItemType){case"Product Backlog Item":e.data.bkcolor="lightblue";break;case"Feature":e.data.bkcolor="purple";break;case"Task":e.data.bkcolor="goldenrod";break;default:e.data.bkcolor="lightgray"}n.push(e)}),t.createHierarchy(n),t.visualize()})},t.prototype.visualize=function(){var e=this;e.cytoscape({container:$("#cy")[0],style:e.cytoscape.stylesheet().selector("node").css({shape:"rectangle",width:"200px",height:"75px",content:"data(name)","text-valign":"center",color:"white","text-outline-color":"white","background-color":"data(bkcolor)","border-color":"data(bordercolor)","border-width":"data(borderwidth)","text-wrap":"wrap","text-max-width":"185px","border-radius":"6px","line-color":"black"}).selector(":selected").css({"line-color":"blue","target-arrow-color":"black","source-arrow-color":"black","text-outline-color":"black","border-width":"2px"}),elements:{nodes:c,edges:u},layout:{name:"dagre",padding:10}}).on("tap","node",function(){try{window.open(this.data("link"))}catch(e){window.location.href=this.data("link")}})},t.prototype.createHierarchy=function(e){var t=this,r=e.reduce(function(e,t){return e[t.data.id]=t,e},{}),n=VSS.getWebContext().collection.uri+"/"+VSS.getWebContext().project.name;e.forEach(function(e){var o={data:{id:e.data.id,name:e.data.name,description:e.data.Description,link:n+"/_workitems#_a=edit&id="+e.data.id+"&fullScreen=true",bkcolor:e.data.bkcolor,bordercolor:t.mappedItems.indexOf(e.data.id.toString())<0?"black":"darkgreen",borderwidth:t.mappedItems.indexOf(e.data.id.toString())<0?"1px":"8px"}};c.push(o);var a=r[e.data.parent];if(a){var i={data:{source:a.data.id,target:e.data.id}};u.push(i)}})},t}(i.ModalDialog);t.VisualizerDialog=p}.apply(t,n))&&(e.exports=o)}])});